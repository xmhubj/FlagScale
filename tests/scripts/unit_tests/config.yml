# Use default configuration if not shown
train_flagscale:
  set_environment:
    - source /root/miniconda3/etc/profile.d/conda.sh
    - conda activate flagscale-train
    - pip install httpx multi-storage-client boto3 google-cloud-storage fastapi uvicorn griffe
    - export PYTHONPATH=./flagscale/train:$PYTHONPATH
    - export NVTE_FLASH_ATTN=0
    - export NVTE_FUSED_ATTN=0
    - ulimit -n 65535
  subset:
    runner:
      type: batch
      depth: all
      ignore:
        - test_parse_hostfile.py
    ./:
      deselect:
        - test_spiky_loss_detector.py::test_spiky_loss_detector
        - test_parallel_context.py::test_parallel_config
      depth: 1

inference_flagscale:
  set_environment:
    - source /root/miniconda3/etc/profile.d/conda.sh
    - conda activate flagscale-inference
    - ulimit -n 65535
  subset:
    inference:
      type: batch
      depth: all
    transformations:
      type: batch
      depth: all
